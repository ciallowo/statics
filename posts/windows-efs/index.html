<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用 Encrypting File System (EFS) 保护你的数据 | 向阳素描</title>
<meta name=keywords content><meta name=description content="0x00 简介 The Encrypting File System (EFS) on Microsoft Windows is a feature introduced in version 3.0 of NTFS[1] that provides filesystem-level encryption. The technology enables files to be transparently encrypted to protect confidential data from attackers with physical access to the computer.
加密文件系统 (EFS) 是 Microsoft Windows 在 NTFS 3.0 版本中引进的功能，其能够提供文件系统级别的加密。该技术能够使文件被透明加密，以防止拥有物理访问权限的攻击者窃取机密数据。
EFS is available in all versions of Windows except the home versions (see Supported operating systems below) from Windows 2000 onwards."><meta name=author content><link rel=canonical href=https://blog.sekaic.icu/posts/windows-efs/><link crossorigin=anonymous href=/assets/css/stylesheet.5dd41d40b8bcabd625b7989d16c0521f4e7cd1dc213d38131b6d170242a57be6.css integrity="sha256-XdQdQLi8q9Ylt5idFsBSH0580dwhPTgTG20XAkKle+Y=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.sekaic.icu/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.sekaic.icu/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.sekaic.icu/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.sekaic.icu/apple-touch-icon.png><link rel=mask-icon href=https://blog.sekaic.icu/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="使用 Encrypting File System (EFS) 保护你的数据"><meta property="og:description" content="0x00 简介 The Encrypting File System (EFS) on Microsoft Windows is a feature introduced in version 3.0 of NTFS[1] that provides filesystem-level encryption. The technology enables files to be transparently encrypted to protect confidential data from attackers with physical access to the computer.
加密文件系统 (EFS) 是 Microsoft Windows 在 NTFS 3.0 版本中引进的功能，其能够提供文件系统级别的加密。该技术能够使文件被透明加密，以防止拥有物理访问权限的攻击者窃取机密数据。
EFS is available in all versions of Windows except the home versions (see Supported operating systems below) from Windows 2000 onwards."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.sekaic.icu/posts/windows-efs/"><meta property="og:image" content="https://blog.sekaic.icu/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-06-21T00:00:00+08:00"><meta property="article:modified_time" content="2021-06-21T00:00:00+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.sekaic.icu/papermod-cover.png"><meta name=twitter:title content="使用 Encrypting File System (EFS) 保护你的数据"><meta name=twitter:description content="0x00 简介 The Encrypting File System (EFS) on Microsoft Windows is a feature introduced in version 3.0 of NTFS[1] that provides filesystem-level encryption. The technology enables files to be transparently encrypted to protect confidential data from attackers with physical access to the computer.
加密文件系统 (EFS) 是 Microsoft Windows 在 NTFS 3.0 版本中引进的功能，其能够提供文件系统级别的加密。该技术能够使文件被透明加密，以防止拥有物理访问权限的攻击者窃取机密数据。
EFS is available in all versions of Windows except the home versions (see Supported operating systems below) from Windows 2000 onwards."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.sekaic.icu/posts/"},{"@type":"ListItem","position":2,"name":"使用 Encrypting File System (EFS) 保护你的数据","item":"https://blog.sekaic.icu/posts/windows-efs/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用 Encrypting File System (EFS) 保护你的数据","name":"使用 Encrypting File System (EFS) 保护你的数据","description":"0x00 简介 The Encrypting File System (EFS) on Microsoft Windows is a feature introduced in version 3.0 of NTFS[1] that provides filesystem-level encryption. The technology enables files to be transparently encrypted to protect confidential data from attackers with physical access to the computer.\n加密文件系统 (EFS) 是 Microsoft Windows 在 NTFS 3.0 版本中引进的功能，其能够提供文件系统级别的加密。该技术能够使文件被透明加密，以防止拥有物理访问权限的攻击者窃取机密数据。\nEFS is available in all versions of Windows except the home versions (see Supported operating systems below) from Windows 2000 onwards.","keywords":[],"articleBody":"0x00 简介 The Encrypting File System (EFS) on Microsoft Windows is a feature introduced in version 3.0 of NTFS[1] that provides filesystem-level encryption. The technology enables files to be transparently encrypted to protect confidential data from attackers with physical access to the computer.\n加密文件系统 (EFS) 是 Microsoft Windows 在 NTFS 3.0 版本中引进的功能，其能够提供文件系统级别的加密。该技术能够使文件被透明加密，以防止拥有物理访问权限的攻击者窃取机密数据。\nEFS is available in all versions of Windows except the home versions (see Supported operating systems below) from Windows 2000 onwards.[2] By default, no files are encrypted, but encryption can be enabled by users on a per-file, per-directory, or per-drive basis. Some EFS settings can also be mandated via Group Policy in Windows domain environments.[3]\n从 Windows 2000 开始，EFS 可用于除家庭版以外的所有其他版本。缺省情况下不会有任何文件被加密，但用户可在各文件、文件夹或驱动器上开启加密。一些 EFS 设置亦可通过域环境中的组策略执行。\nCryptographic file system implementations for other operating systems are available, but the Microsoft EFS is not compatible with any of them.[4] See also the list of cryptographic file systems.\n其他操作系统亦有提供加密文件系统，但 Microsoft EFS 与它们并不兼容。\n——以上内容来自维基百科 Encrypting File System\n0x01 生成 EFS 证书 打开 PowerShell 或 CMD，键入以下命令以生成 EFS 证书\n$ CIPHER /K [/ECC:256|384|521] ECC 是可选项，开启时会使用 NIST 提供的标准化椭圆曲线，如果不信任 NIST 那就直接键入 CIPHER /K，默认生成 2048 位的 RSA 密钥。\n0x02 备份 EFS 证书 运行 certmgr.msc 打开当前用户的证书管理器，在「当前用户 -\u003e 个人 -\u003e 证书」路径下，找到当前登录的用户名为名称的证书。右键单击该证书，在 选择「所有任务 -\u003e 导出」。在之后弹出证书导出向导中选择「导出私钥」，随后输入保护私钥的口令并设置保存路径，其它选项默认即可。导出的证书将是一个 pfx 为后缀的 PKCS #12 标准归档文件，包含私钥在内的完整证书内容，该文件须离线保存保证其安全。\n在备份完成后，应该先删除已经导入的证书再从导出的备份重新导入，重新导入时勾选「私钥不可导出」以加强安全性。\n如果丢失了证书私钥，将永远无法打开或恢复被加密的数据，请妥善备份！\n0x03 使用 EFS 保护你的数据 对任意想要进行保护的文件或文件夹单击右键，依次点击「高级 -\u003e 加密内容以便保护数据 -\u003e 确定」，即可完成对该数据的保护。\r已加密的文件夹\n还可以在注册表 HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced 中新建一个名为 EncryptionContextMenu 的 DWORD（32 位）值，并将值设置为 1，便可开启右键菜单加密选项。 右键加密\n0x04 注意事项 EFS 加密对当前用户是透明的，只要正确输入当前用户的账户口令便可以访问所有已加密的数据，而无需再额外输入其他口令；而使用了 EFS 加密的数据，其他用户没有访问权限，无法查看或修改受 EFS 保护的内容。\n此外，如果计算机管理员修改了启用 EFS 的用户账户口令并进行登录的，EFS 仍能够保护你的数据，计算机管理员是无法打开受保护的项目的。\n0x05 免责声明 本文仅供学习使用，作者不对内容的有效性、真实性、合法性提供任何形式的明示或者默示保证，因文本内容所生包括但不限于合同纠纷、侵权纠纷、纯粹经济损失等均与作者无关。\n","wordCount":"232","inLanguage":"zh","datePublished":"2021-06-21T00:00:00+08:00","dateModified":"2021-06-21T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.sekaic.icu/posts/windows-efs/"},"publisher":{"@type":"Organization","name":"向阳素描","logo":{"@type":"ImageObject","url":"https://blog.sekaic.icu/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.sekaic.icu/ accesskey=h title="向阳素描 (Alt + H)">向阳素描</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.sekaic.icu/about title=关于我😈><span>关于我😈</span></a></li><li><a href=https://blog.sekaic.icu/archives title=归档><span>归档</span></a></li><li><a href=https://blog.sekaic.icu/search/ title=搜索><span>搜索</span></a></li><li><a href=https://blog.sekaic.icu/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">使用 Encrypting File System (EFS) 保护你的数据</h1><div class=post-meta><span title='2021-06-21 00:00:00 +0800 +0800'>2021 年 6 月 21 日</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#0x00-%e7%ae%80%e4%bb%8b aria-label="0x00 简介">0x00 简介</a></li><li><a href=#0x01-%e7%94%9f%e6%88%90-efs-%e8%af%81%e4%b9%a6 aria-label="0x01 生成 EFS 证书">0x01 生成 EFS 证书</a></li><li><a href=#0x02-%e5%a4%87%e4%bb%bd-efs-%e8%af%81%e4%b9%a6 aria-label="0x02 备份 EFS 证书">0x02 备份 EFS 证书</a></li><li><a href=#0x03-%e4%bd%bf%e7%94%a8-efs-%e4%bf%9d%e6%8a%a4%e4%bd%a0%e7%9a%84%e6%95%b0%e6%8d%ae aria-label="0x03 使用 EFS 保护你的数据">0x03 使用 EFS 保护你的数据</a></li><li><a href=#0x04-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label="0x04 注意事项">0x04 注意事项</a></li><li><a href=#0x05-%e5%85%8d%e8%b4%a3%e5%a3%b0%e6%98%8e aria-label="0x05 免责声明">0x05 免责声明</a></li></ul></div></details></div><div class=post-content><h2 id=0x00-简介>0x00 简介<a hidden class=anchor aria-hidden=true href=#0x00-简介>#</a></h2><blockquote><p>The <strong>Encrypting File System</strong> (<strong>EFS</strong>) on <a href=https://en.wikipedia.org/wiki/Microsoft_Windows>Microsoft Windows</a> is a feature introduced in version 3.0 of <a href=https://en.wikipedia.org/wiki/NTFS title=NTFS>NTFS</a><a href=https://en.wikipedia.org/wiki/Encrypting_File_System#cite_note-1>[1]</a> that provides <a href=https://en.wikipedia.org/wiki/Filesystem-level_encryption title="Filesystem-level encryption">filesystem-level encryption</a>. The technology enables files to be <a href=https://en.wikipedia.org/wiki/Transparency_(human%E2%80%93computer_interaction) title="Transparency (human–computer interaction)">transparently</a> <a href=https://en.wikipedia.org/wiki/Encryption title=Encryption>encrypted</a> to protect confidential data from attackers with physical access to the computer.<br><strong>加密文件系统 (EFS)</strong> 是 Microsoft Windows 在 NTFS 3.0 版本中引进的功能，其能够提供文件系统级别的加密。该技术能够使文件被透明加密，以防止拥有物理访问权限的攻击者窃取机密数据。</p><p>EFS is available in all versions of Windows except the home versions (see <a href=https://en.wikipedia.org/wiki/Encrypting_File_System#Supported_operating_systems title="Encrypting File System">Supported operating systems</a> below) from <a href=https://en.wikipedia.org/wiki/Windows_2000 title="Windows 2000">Windows 2000</a> onwards.<a href=https://en.wikipedia.org/wiki/Encrypting_File_System#cite_note-2>[2]</a> By default, no files are encrypted, but encryption can be enabled by users on a per-file, per-directory, or per-drive basis. Some EFS settings can also be mandated via <a href=https://en.wikipedia.org/wiki/Group_Policy title="Group Policy">Group Policy</a> in <a href=https://en.wikipedia.org/wiki/Windows_domain title="Windows domain">Windows domain</a> environments.<a href=https://en.wikipedia.org/wiki/Encrypting_File_System#cite_note-3>[3]</a><br>从 Windows 2000 开始，EFS 可用于<strong>除家庭版</strong>以外的所有其他版本。缺省情况下不会有任何文件被加密，但用户可在各文件、文件夹或驱动器上开启加密。一些 EFS 设置亦可通过域环境中的组策略执行。</p><p>Cryptographic file system implementations for other operating systems are available, but the Microsoft EFS is not compatible with any of them.<a href=https://en.wikipedia.org/wiki/Encrypting_File_System#cite_note-4>[4]</a> See also the <a href=https://en.wikipedia.org/wiki/List_of_cryptographic_file_systems title="List of cryptographic file systems">list of cryptographic file systems</a>.<br>其他操作系统亦有提供加密文件系统，但 Microsoft EFS 与它们并不兼容。</p><p>——以上内容来自维基百科 <a href=https://en.wikipedia.org/wiki/Encrypting_File_System>Encrypting File System</a></p></blockquote><h2 id=0x01-生成-efs-证书>0x01 生成 EFS 证书<a hidden class=anchor aria-hidden=true href=#0x01-生成-efs-证书>#</a></h2><p>打开 PowerShell 或 CMD，键入以下命令以生成 EFS 证书</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ CIPHER /K <span class=o>[</span>/ECC:256<span class=p>|</span>384<span class=p>|</span>521<span class=o>]</span> 
</span></span></code></pre></div><p>ECC 是可选项，开启时会使用 NIST 提供的标准化椭圆曲线，如果不信任 NIST 那就直接键入 <code>CIPHER /K</code>，默认生成 2048 位的 RSA 密钥。</p><h2 id=0x02-备份-efs-证书>0x02 备份 EFS 证书<a hidden class=anchor aria-hidden=true href=#0x02-备份-efs-证书>#</a></h2><p>运行 <code>certmgr.msc</code> 打开当前用户的证书管理器，在「当前用户 -> 个人 -> 证书」路径下，找到当前登录的用户名为名称的证书。右键单击该证书，在 选择「所有任务 -> 导出」。在之后弹出证书导出向导中选择「导出私钥」，随后输入保护私钥的口令并设置保存路径，其它选项默认即可。导出的证书将是一个 pfx 为后缀的 PKCS #12 标准归档文件，包含私钥在内的完整证书内容，该文件须离线保存保证其安全。</p><p>在备份完成后，应该先删除已经导入的证书再从导出的备份重新导入，重新导入时勾选「私钥不可导出」以加强安全性。</p><p><strong>如果丢失了证书私钥，将永远无法打开或恢复被加密的数据，请妥善备份！</strong></p><h2 id=0x03-使用-efs-保护你的数据>0x03 使用 EFS 保护你的数据<a hidden class=anchor aria-hidden=true href=#0x03-使用-efs-保护你的数据>#</a></h2><p>对任意想要进行保护的文件或文件夹单击右键，依次点击「高级 -> 加密内容以便保护数据 -> 确定」，即可完成对该数据的保护。<figure align=center><img loading=lazy src=encrypted-folder.png#center><figcaption><p>已加密的文件夹</p></figcaption></figure></p><p>还可以在注册表 <code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced</code> 中新建一个名为 <code>EncryptionContextMenu</code> 的 DWORD（32 位）值，并将值设置为 1，便可开启右键菜单加密选项。<figure align=center><img loading=lazy src=right-click.png#center><figcaption><p>右键加密</p></figcaption></figure></p><h2 id=0x04-注意事项>0x04 注意事项<a hidden class=anchor aria-hidden=true href=#0x04-注意事项>#</a></h2><p>EFS 加密对当前用户是透明的，只要正确输入当前用户的账户口令便可以访问所有已加密的数据，而无需再额外输入其他口令；而使用了 EFS 加密的数据，其他用户没有访问权限，无法查看或修改受 EFS 保护的内容。</p><p>此外，如果计算机管理员修改了启用 EFS 的用户账户口令并进行登录的，EFS 仍能够保护你的数据，计算机管理员是无法打开受保护的项目的。</p><h2 id=0x05-免责声明>0x05 免责声明<a hidden class=anchor aria-hidden=true href=#0x05-免责声明>#</a></h2><p>本文仅供学习使用，作者不对内容的有效性、真实性、合法性提供任何形式的明示或者默示保证，因文本内容所生包括但不限于合同纠纷、侵权纠纷、纯粹经济损失等均与作者无关。</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://blog.sekaic.icu/posts/street-photography/><span class=title>« 上一页</span><br><span>一些扫街的照片</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.sekaic.icu/>向阳素描</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>